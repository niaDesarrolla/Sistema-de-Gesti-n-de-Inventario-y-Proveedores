-- ******************************************************
-- SISTEMA DE GESTIÓN DE INVENTARIO Y PROVEEDORES (DDL)
-- ******************************************************

-- ======================================================
-- 1. CREACIÓN DE NUEVO USUARIO/ESQUEMA DE TRABAJO
--    (Ejecución en la conexión SYSTEM o SYS)
-- ======================================================

CREATE USER GESTION_INVENTARIO IDENTIFIED BY  MI_CONTRASEÑA DEFAULT TABLESPACE users;

-- 2. Asignación de privilegios de DESARROLLO:
-- CONNECT: Permite iniciar sesión en la base de datos.
-- RESOURCE: Permite crear tablas, secuencias, procedimientos, etc.
-- UNLIMITED TABLESPACE: Permite al usuario crecer sin límites en el tablespace por defecto (USERS).
GRANT CONNECT, RESOURCE, UNLIMITED TABLESPACE TO GESTION_INVENTARIO;


-- ======================================================
-- 2. CREACIÓN DE LA ESTRUCTURA DE TABLAS
--    (Ejecutamos en la conexión GESTION_INVENTARIO)
-- ======================================================

-- 2.1. Tabla PROVEEDORES: Maestra de entidades
CREATE TABLE PROVEEDORES (
    proveedor_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    nombre VARCHAR2(100) NOT NULL,
    contacto VARCHAR2(100),
    telefono VARCHAR2(15),
    email VARCHAR2(100),
    CONSTRAINT pk_proveedores PRIMARY KEY (proveedor_id)
);


-- 2.2. Tabla PRODUCTOS: Maestra de inventario
CREATE TABLE PRODUCTOS (
    producto_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    nombre VARCHAR2(100) NOT NULL,
    descripcion VARCHAR2(255),
    precio_unitario NUMBER(10, 2),
    stock_actual NUMBER DEFAULT 0 NOT NULL,
    proveedor_id NUMBER,
    CONSTRAINT pk_productos PRIMARY KEY (producto_id),
    CONSTRAINT fk_productos_proveedor FOREIGN KEY (proveedor_id)
        REFERENCES PROVEEDORES(proveedor_id)
);


-- 2.3. Tabla COMPRAS: Cabecera de la transacción
-- Registra cuándo se hizo la compra y a qué proveedor.
CREATE TABLE COMPRAS (
    compra_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    proveedor_id NUMBER NOT NULL,
    fecha_compra DATE DEFAULT SYSDATE NOT NULL,
    total_compra NUMBER(10, 2) DEFAULT 0,
    CONSTRAINT pk_compras PRIMARY KEY (compra_id),
    CONSTRAINT fk_compras_proveedor FOREIGN KEY (proveedor_id)
        REFERENCES PROVEEDORES(proveedor_id)
);


-- 2.4. Tabla DETALLE_COMPRA: Tabla de enlace (Relación N:M)
-- Enlaza la compra con los productos y registra las cantidades y precios transaccionales.
CREATE TABLE DETALLE_COMPRA (
    detalle_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    compra_id NUMBER NOT NULL,
    producto_id NUMBER NOT NULL,
    cantidad NUMBER NOT NULL,
    precio_compra NUMBER(10, 2) NOT NULL,
    CONSTRAINT pk_detalle_compra PRIMARY KEY (detalle_id),
    CONSTRAINT fk_detalle_compra_compra FOREIGN KEY (compra_id)
        REFERENCES COMPRAS(compra_id),
    CONSTRAINT fk_detalle_compra_producto FOREIGN KEY (producto_id)
        REFERENCES PRODUCTOS(producto_id)
);

